<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>G·ª≠i Pina c·ªßa anh üíï</title>

  <!-- Google Font (allowed) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* =========================
       THEME / GLOBAL
    ========================== */
    :root{
      --bg1:#ffe2ee;
      --bg2:#fff1f7;
      --card: rgba(255,255,255,.78);
      --stroke: rgba(255, 80, 150, .22);
      --text:#2a2a2a;
      --hot:#ff2f7a;
      --hot2:#ff66a6;
      --shadow: 0 18px 45px rgba(0,0,0,.10);
      --softShadow: 0 12px 28px rgba(255,47,122,.16);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: "Baloo 2", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 30% 15%, var(--bg2), transparent 60%),
                  radial-gradient(1000px 700px at 80% 30%, #ffe9f1, transparent 55%),
                  linear-gradient(180deg, var(--bg1), #ffffff);
      overflow-x:hidden;
    }

    .app{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      position:relative;
      isolation:isolate;
    }

    /* Floating hearts layer */
    .float-layer{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      overflow:hidden;
    }
    .float-heart{
      position:absolute;
      bottom:-40px;
      font-size:20px;
      opacity:.28;
      filter: drop-shadow(0 10px 12px rgba(255,47,122,.10));
      animation: floatUp linear infinite;
      transform: translateZ(0);
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0%   { transform: translateY(0) translateX(0) rotate(0deg) scale(.95); opacity:0; }
      12%  { opacity:.34; }
      85%  { opacity:.30; }
      100% { transform: translateY(-120vh) translateX(var(--drift, 40px)) rotate(360deg) scale(1.08); opacity:0; }
    }

    /* Click sparkle/hearts */
    .pop{
      position:fixed;
      pointer-events:none;
      z-index:10;
      font-size:18px;
      transform: translate(-50%,-50%);
      animation: popFade 800ms ease-out forwards;
      filter: drop-shadow(0 10px 16px rgba(255,47,122,.14));
      will-change: transform, opacity;
    }
    @keyframes popFade{
      0%   { opacity:0; transform: translate(-50%,-50%) scale(.6); }
      15%  { opacity:1; }
      100% { opacity:0; transform: translate(-50%,-85%) scale(1.25); }
    }

    /* Music toggle icon */
    .music-toggle{
      position:fixed;
      top:14px;
      right:14px;
      z-index:20;
      width:44px;
      height:44px;
      border-radius:999px;
      border:1px solid rgba(255,47,122,.22);
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      box-shadow: var(--softShadow);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      opacity:0;
      pointer-events:none;
      transform: translateY(-6px);
      transition: opacity 350ms ease, transform 350ms ease;
    }
    .music-toggle.show{
      opacity:1;
      pointer-events:auto;
      transform: translateY(0);
    }
    .music-toggle span{
      font-size:20px;
      line-height:1;
    }
    .music-toggle[aria-pressed="false"] span{
      filter: grayscale(1);
      opacity:.7;
    }

    /* =========================
       INTRO / GIFT SCREEN
    ========================== */
    .stage{
      width:min(920px, 92vw);
      position:relative;
      z-index:1;
    }

    .intro{
      width:100%;
      min-height: 74vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }

    .gift-wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      text-align:center;
      user-select:none;
    }

    .hint{
      font-size:14px;
      opacity:.7;
      letter-spacing:.2px;
    }

    /* Gift box */
    .gift{
      position:relative;
      width:min(280px, 78vw);
      aspect-ratio: 1 / 1;
      cursor:pointer;
      outline:none;
      transform: translateZ(0);
      filter: drop-shadow(0 18px 26px rgba(0,0,0,.10));
      animation: giftIdle 2.2s ease-in-out infinite;
    }
    @keyframes giftIdle{
      0%   { transform: translateY(0) scale(1); }
      50%  { transform: translateY(-7px) scale(1.01); }
      100% { transform: translateY(0) scale(1); }
    }

    .gift:focus-visible{
      box-shadow: 0 0 0 4px rgba(255,47,122,.22);
      border-radius:24px;
    }

    .box-base{
      position:absolute;
      inset:auto 0 0 0;
      height:62%;
      background: linear-gradient(180deg, #ffd1e2, #ffb9d3);
      border:1px solid rgba(255,47,122,.18);
      border-radius: 20px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .box-base::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(450px 200px at 50% 10%, rgba(255,255,255,.55), transparent 60%);
      opacity:.8;
    }

    .lid{
      position:absolute;
      left:6%;
      right:6%;
      top:4%;
      height:28%;
      background: linear-gradient(180deg, #ffe5f0, #ffc8dd);
      border:1px solid rgba(255,47,122,.18);
      border-radius: 18px;
      transform-origin: 12% 90%;
      box-shadow: 0 14px 26px rgba(0,0,0,.10);
    }

    /* Ribbon */
    .ribbon-v{
      position:absolute;
      top:0;
      bottom:0;
      left:50%;
      width:18%;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #ff4f8f, #ff2f7a);
      opacity:.95;
      filter: drop-shadow(0 10px 14px rgba(255,47,122,.18));
    }
    .ribbon-h{
      position:absolute;
      left:0;
      right:0;
      top:43%;
      height:12%;
      background: linear-gradient(180deg, #ff65a3, #ff2f7a);
      opacity:.95;
    }

    /* Bow */
    .bow{
      position:absolute;
      top:10%;
      left:50%;
      transform: translateX(-50%);
      width:52%;
      height:30%;
      pointer-events:none;
    }
    .bow::before,
    .bow::after{
      content:"";
      position:absolute;
      top:22%;
      width:48%;
      height:56%;
      background: linear-gradient(180deg, #ff78b1, #ff2f7a);
      border-radius: 22px 22px 22px 22px;
      box-shadow: 0 12px 20px rgba(255,47,122,.16);
    }
    .bow::before{ left:0; transform: rotate(-18deg); }
    .bow::after { right:0; transform: rotate(18deg); }
    .bow .knot{
      position:absolute;
      left:50%;
      top:32%;
      transform: translate(-50%, -50%);
      width:18%;
      height:34%;
      background: linear-gradient(180deg, #ff8abb, #ff2f7a);
      border-radius:999px;
      box-shadow: 0 12px 18px rgba(255,47,122,.14);
    }

    /* Heart icon on gift */
    .gift-heart{
      position:absolute;
      left:50%;
      bottom:18%;
      transform: translateX(-50%);
      width:46px;
      height:46px;
      border-radius:14px;
      background: rgba(255,255,255,.6);
      border: 1px solid rgba(255,47,122,.22);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 12px 18px rgba(0,0,0,.06);
      pointer-events:none;
    }
    .gift-heart span{
      font-size:22px;
      filter: drop-shadow(0 10px 14px rgba(255,47,122,.12));
    }

    /* Gift text */
    .gift-text{
      margin-top:6px;
      font-weight:800;
      font-size: clamp(18px, 3.6vw, 24px);
      line-height:1.15;
      color:#2b2b2b;
      text-shadow: 0 10px 16px rgba(255,47,122,.10);
      white-space:pre-line;
    }

    /* Open animation states */
    .gift.opening .lid{
      animation: lidOpen 720ms cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes lidOpen{
      0%   { transform: rotate(0deg) translateY(0); }
      100% { transform: rotate(-42deg) translate(-14px, -18px); }
    }
    .gift.opening .box-base{
      animation: baseShake 560ms ease-in-out 120ms;
    }
    @keyframes baseShake{
      0% { transform: translateX(0); }
      20%{ transform: translateX(-3px); }
      40%{ transform: translateX(3px); }
      60%{ transform: translateX(-2px); }
      80%{ transform: translateX(2px); }
      100%{ transform: translateX(0); }
    }

    .burst{
      position:absolute;
      left:50%;
      top:50%;
      width:10px;
      height:10px;
      transform: translate(-50%,-50%);
      pointer-events:none;
      opacity:0;
    }
    .gift.opening .burst{
      animation: burstPop 920ms ease-out forwards;
    }
    @keyframes burstPop{
      0%{ opacity:0; transform: translate(-50%,-50%) scale(.6); }
      10%{ opacity:1; }
      100%{ opacity:0; transform: translate(-50%,-50%) scale(18); }
    }
    .burst::before{
      content:"";
      position:absolute;
      inset:-10px;
      background: radial-gradient(circle, rgba(255,255,255,.95), rgba(255,200,226,.75), transparent 62%);
      border-radius:999px;
      filter: blur(1px);
    }

    .intro.fade-out{
      animation: introFade 650ms ease forwards;
    }
    @keyframes introFade{
      to{ opacity:0; transform: translateY(12px); }
    }

    /* =========================
       MAIN CONTENT
    ========================== */
    .content{
      display:none;
      width:100%;
      padding: 22px 0 8px;
    }
    .content.show{
      display:block;
      animation: contentIn 900ms ease forwards;
    }
    @keyframes contentIn{
      from{ opacity:0; transform: translateY(18px); }
      to  { opacity:1; transform: translateY(0); }
    }

    .card{
      width:100%;
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: 26px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .inner{
      padding: 22px;
    }

    .title{
      text-align:center;
      font-weight:900;
      color: var(--hot);
      font-size: clamp(28px, 5vw, 48px);
      margin: 6px 0 10px;
      letter-spacing:.2px;
      transform-origin:center;
      opacity:0;
      transform: scale(.92);
      animation: titleIn 900ms cubic-bezier(.2,.9,.2,1) forwards;
      text-shadow: 0 14px 26px rgba(255,47,122,.14);
    }
    @keyframes titleIn{
      to{ opacity:1; transform: scale(1); }
    }

    .subline{
      text-align:center;
      font-size: 14px;
      opacity:.75;
      margin: 0 0 14px;
    }

    .message{
      margin: 10px auto 4px;
      max-width: 760px;
      text-align:center;
      font-size: clamp(16px, 2.6vw, 19px);
      line-height:1.7;
      position:relative;
    }
    .msg-line{
      opacity:0;
      transform: translateY(10px);
      transition: opacity 800ms ease, transform 800ms ease;
      will-change: opacity, transform;
      margin: 6px 0;
    }
    .msg-line.show{
      opacity:1;
      transform: translateY(0);
    }

    /* Soft hearts around text */
    .around-hearts{
      position:absolute;
      inset:-10px;
      pointer-events:none;
      opacity:.35;
    }
    .around-hearts span{
      position:absolute;
      animation: drift 6.5s ease-in-out infinite;
      filter: drop-shadow(0 12px 16px rgba(255,47,122,.10));
    }
    @keyframes drift{
      0%,100%{ transform: translateY(0) scale(1); opacity:.65; }
      50%{ transform: translateY(-10px) scale(1.06); opacity:1; }
    }

    /* Question section */
    .question{
      margin: 18px auto 8px;
      text-align:center;
      font-weight:800;
      font-size: clamp(18px, 3.4vw, 22px);
      color:#2d2d2d;
      opacity:0;
      transform: translateY(10px);
      transition: opacity 700ms ease, transform 700ms ease;
    }
    .question.show{
      opacity:1;
      transform: translateY(0);
    }

    .choices{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 12px;
    }

    @media (max-width: 740px){
      .choices{ grid-template-columns: 1fr; }
    }

    .choice{
      border-radius: 20px;
      border: 1px solid rgba(0,0,0,.06);
      background: rgba(255,255,255,.72);
      box-shadow: 0 14px 30px rgba(0,0,0,.06);
      padding: 14px 14px 12px;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      transform: translateY(12px);
      opacity:0;
      transition: transform 700ms cubic-bezier(.2,.9,.2,1), opacity 700ms ease, box-shadow 250ms ease;
      user-select:none;
      min-height: 86px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-weight:900;
      letter-spacing:.2px;
    }
    .choice:hover{
      box-shadow: 0 18px 44px rgba(255,47,122,.12);
    }
    .choice.show{
      opacity:1;
      transform: translateY(0);
    }

    .choice::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(600px 220px at 50% 0%, rgba(255,255,255,.65), transparent 60%);
      opacity:.85;
      pointer-events:none;
    }
    .choice .emoji{
      font-size: 18px;
      margin-right:8px;
    }

    .choice.pink{ background: linear-gradient(180deg, rgba(255,214,232,.82), rgba(255,185,211,.68)); }
    .choice.blue{ background: linear-gradient(180deg, rgba(207,236,255,.85), rgba(177,218,255,.68)); }
    .choice.myst{ background: linear-gradient(180deg, rgba(245,228,255,.85), rgba(224,197,255,.68)); }

    /* Result panel */
    .result{
      margin-top: 14px;
      border-radius: 20px;
      border: 1px solid rgba(255,47,122,.18);
      background: rgba(255,255,255,.72);
      box-shadow: 0 16px 42px rgba(0,0,0,.06);
      padding: 14px 14px 12px;
      min-height: 76px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .result::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(600px 220px at 50% 0%, rgba(255,255,255,.7), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }
    .result .text{
      position:relative;
      z-index:1;
      font-weight:700;
      font-size: clamp(16px, 2.8vw, 18px);
      line-height:1.6;
      padding: 6px 8px;
    }

    .muted{ opacity:.65; font-weight:600; }

    /* Buttons in result (for Box 2) */
    .mini-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top:10px;
    }
    .btn{
      border:0;
      border-radius: 999px;
      padding:10px 14px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.1px;
      background: rgba(255,47,122,.92);
      color:white;
      box-shadow: 0 14px 30px rgba(255,47,122,.18);
      transition: transform 120ms ease, filter 120ms ease;
    }
    .btn:active{ transform: scale(.98); }
    .btn.alt{
      background: rgba(85,155,255,.92);
      box-shadow: 0 14px 30px rgba(85,155,255,.18);
    }

    /* playful shake */
    .shake{
      animation: shake 420ms ease-in-out 1;
    }
    @keyframes shake{
      0%,100%{ transform: translateX(0); }
      20%{ transform: translateX(-6px); }
      40%{ transform: translateX(6px); }
      60%{ transform: translateX(-4px); }
      80%{ transform: translateX(4px); }
    }

    /* typing effect for box 3 */
    .typing{
      font-weight:800;
      white-space:pre-line;
    }
    .caret{
      display:inline-block;
      width:.6ch;
      animation: blink 800ms step-end infinite;
    }
    @keyframes blink{ 50%{ opacity:0; } }

    /* Bottom love section */
    .bottom{
      margin-top: 18px;
      padding: 18px 22px 20px;
      border-top: 1px solid rgba(255,47,122,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.28), rgba(255,255,255,.10));
    }
    .bottom-grid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items:center;
    }
    @media (max-width: 740px){
      .bottom-grid{ grid-template-columns: 1fr; text-align:center; }
    }
    .love-lines{
      display:flex;
      flex-direction:column;
      gap: 6px;
      opacity:0;
      transform: translateY(10px);
      animation: bottomIn 900ms ease forwards;
      animation-delay: 1.5s;
    }
    @keyframes bottomIn{
      to{ opacity:1; transform: translateY(0); }
    }
    .love-lines div{
      font-weight:900;
      font-size: clamp(16px, 3vw, 18px);
    }
    .signature{
      font-weight:900;
      color: var(--hot);
      font-size: 20px;
      opacity:0;
      transform: translateY(10px);
      animation: bottomIn 900ms ease forwards;
      animation-delay: 1.75s;
    }

    /* small floating hearts near bottom */
    .mini-float{
      display:inline-flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      margin-top:8px;
      opacity:.65;
    }
    .mini-float span{
      animation: miniBob 2.8s ease-in-out infinite;
      filter: drop-shadow(0 12px 14px rgba(255,47,122,.12));
    }
    .mini-float span:nth-child(2){ animation-delay: .4s; }
    .mini-float span:nth-child(3){ animation-delay: .8s; }
    @keyframes miniBob{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-6px); }
    }

    /* Reduce motion preference */
    @media (prefers-reduced-motion: reduce){
      .float-heart, .gift, .around-hearts span, .mini-float span{
        animation:none !important;
      }
      .msg-line, .question, .choice{ transition:none !important; }
    }
  </style>
</head>

<body>
  <!-- Floating hearts background -->
  <div class="float-layer" id="floatLayer" aria-hidden="true"></div>

  <!-- Music toggle (appears after gift click) -->
  <button class="music-toggle" id="musicToggle" aria-label="B·∫≠t/t·∫Øt nh·∫°c" aria-pressed="true" title="B·∫≠t/t·∫Øt nh·∫°c">
    <span id="musicIcon">üéµ</span>
  </button>

  <div class="app">
    <div class="stage">

      <!-- INTRO SCREEN -->
      <section class="intro" id="intro">
        <div class="gift-wrap">
          <div class="gift" id="gift" tabindex="0" role="button" aria-label="M·ªü qu√†">
            <div class="lid"></div>
            <div class="box-base">
              <div class="ribbon-v"></div>
              <div class="ribbon-h"></div>
              <div class="gift-heart"><span>üíó</span></div>
            </div>
            <div class="bow"><div class="knot"></div></div>
            <div class="burst" aria-hidden="true"></div>
          </div>

          <div class="gift-text">
Pina d·ªÖ th∆∞∆°ng
anh th∆∞∆°ng pina l·∫Øm
          </div>

          <div class="hint">Ch·∫°m v√†o h·ªôp qu√† ƒëi n√® üéÅ</div>
        </div>
      </section>

      <!-- MAIN CONTENT (hidden until gift opened) -->
      <section class="content" id="content" aria-live="polite">
        <div class="card">
          <div class="inner">

            <div class="title" id="title">G·ª≠i Pina c·ªßa anh üíï</div>

            <div class="message" id="message">
              <div class="around-hearts" aria-hidden="true">
                <span style="left:6%; top:22%; animation-delay:.2s;">üíó</span>
                <span style="right:8%; top:18%; animation-delay:.6s;">üíñ</span>
                <span style="left:10%; bottom:10%; animation-delay:1.1s;">üíï</span>
                <span style="right:12%; bottom:12%; animation-delay:1.5s;">üíò</span>
              </div>

              <!-- Lines will appear with timing -->
              <div class="msg-line" data-delay="200">Nh√¢n d·ªãp nƒÉm m·ªõi 2026</div>
              <div class="msg-line" data-delay="900">Anh ch√∫c Pina lu√¥n xinh x·∫Øn, ƒë√°ng y√™u, d·ªÖ th∆∞∆°ng,</div>
              <div class="msg-line" data-delay="1600">c√≥ nhi·ªÅu s·ª©c kh·ªèe,</div>
              <div class="msg-line" data-delay="2300">ƒë·∫°t ƒë∆∞·ª£c m·ªçi ∆∞·ªõc nguy·ªán</div>
              <div class="msg-line" data-delay="3000">v√† h·∫°nh ph√∫c b√™n gia ƒë√¨nh,</div>
              <div class="msg-line" data-delay="3700">b√™n anh d√†i d√†i üíñüíñüíñ</div>
            </div>

            <div class="question" id="question">Pina mu·ªën anh ch·ªü ƒëi ch∆°i T·∫øt ·ªü ƒë√¢u taaa~</div>

            <div class="choices" id="choices">
              <div class="choice pink" id="box1" data-box="1">
                <span class="emoji">üéÄ</span>Box1 n√®ee
              </div>
              <div class="choice blue" id="box2" data-box="2">
                <span class="emoji">üé¨</span>Box2 th√¨ saooo
              </div>
              <div class="choice myst" id="box3" data-box="3">
                <span class="emoji">üîí</span>Box3 hehe
              </div>
            </div>

            <div class="result" id="result">
              <div class="text muted" id="resultText"> üßß Happy New Year 2026 üßß üíó</div>
            </div>

          </div>

          <div class="bottom">
            <div class="bottom-grid">
              <div class="love-lines">
                <div>Anh th∆∞∆°ng Pina nh·∫•t tr√™n ƒë·ªùi üíóüíóüíó</div>
                <div>Anh y√™u Pinaa l·∫Ømmm üíóüíóüíó </div>
                <div>T·ª•i m√¨nh c√πng c·ªë g·∫Øng v·ªÅ 1 nh√† nhaaaaa üíóüíç</div>
                <div class="mini-float" aria-hidden="true"><span>üíó</span><span>üíñ</span><span>üíï</span></div>
              </div>
              <div class="signature">Anh y√™u c·ªßa Pinaaa</div>
            </div>
          </div>

        </div>
      </section>

    </div>
  </div>

  <!-- AUDIO (NO AUTOPLAY; starts only after gift click) -->
  <!-- IMPORTANT: Put the mp3 file in the SAME folder as index.html on GitHub Pages and name it: mot-ngay-hay-tram-nam.mp3 -->
  <audio id="bgm" loop preload="none">
    <source src="mot-ngay-hay-tram-nam.mp3" type="audio/mpeg">
  </audio>

  <script>
    /* =========================================================
       EDIT THESE EASILY LATER (text / music file name)
    ========================================================== */
    const MUSIC_FILE = "mot-ngay-hay-tram-nam.mp3"; // upload this mp3 to repo (same folder)
    const MUSIC_VOLUME = 0.28; // soft romantic volume (0.0 - 1.0)

    /* =========================================================
       DOM HELPERS
    ========================================================== */
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const floatLayer = $("#floatLayer");
    const intro = $("#intro");
    const content = $("#content");
    const gift = $("#gift");
    const bgm = $("#bgm");
    const musicToggle = $("#musicToggle");
    const musicIcon = $("#musicIcon");

    const msgLines = $$(".msg-line");
    const question = $("#question");
    const choices = $("#choices");
    const result = $("#result");
    const resultText = $("#resultText");

    const box1 = $("#box1");
    const box2 = $("#box2");
    const box3 = $("#box3");

    let giftOpened = false;
    let currentActionToken = 0;
    let musicOn = true;

    /* =========================================================
       BACKGROUND FLOATING HEARTS (continuous)
    ========================================================== */
    const FLOAT_ICONS = ["üíó","üíñ","üíï","üíò","‚ù§Ô∏è","‚ú®"];
    function spawnFloatHeart(){
      const el = document.createElement("div");
      el.className = "float-heart";
      el.textContent = FLOAT_ICONS[Math.floor(Math.random()*FLOAT_ICONS.length)];

      const left = Math.random()*100;
      el.style.left = left + "vw";

      const size = 14 + Math.random()*18;
      el.style.fontSize = size + "px";

      const dur = 7 + Math.random()*8; // romantic slow
      el.style.animationDuration = dur + "s";

      const drift = (-40 + Math.random()*80).toFixed(0) + "px";
      el.style.setProperty("--drift", drift);

      el.style.animationDelay = (Math.random()*1.2).toFixed(2) + "s";

      floatLayer.appendChild(el);
      window.setTimeout(() => el.remove(), (dur + 1.5) * 1000);
    }
    // Start hearts
    const heartInterval = window.setInterval(spawnFloatHeart, 420);

    /* =========================================================
       CLICK EFFECT (heart/sparkle appears and fades)
    ========================================================== */
    const POPS = ["üíñ","‚ú®","üíó","üíï","üíò"];
    window.addEventListener("pointerdown", (e) => {
      // prevent double pop when clicking the gift on mobile due to focus/keydown
      popAt(e.clientX, e.clientY);
    }, { passive:true });

    function popAt(x, y){
      const el = document.createElement("div");
      el.className = "pop";
      el.textContent = POPS[Math.floor(Math.random()*POPS.length)];
      el.style.left = x + "px";
      el.style.top = y + "px";
      document.body.appendChild(el);
      window.setTimeout(() => el.remove(), 900);
    }

    /* =========================================================
       INTRO -> OPEN GIFT -> REVEAL CONTENT + START MUSIC
    ========================================================== */
    // Ensure audio source uses configured file (easy edit)
    (function initAudio(){
      const src = bgm.querySelector("source");
      src.setAttribute("src", MUSIC_FILE);
      bgm.load();
      bgm.volume = MUSIC_VOLUME;
    })();

    function startMusic(){
      if (!musicOn) return;
      // Must be triggered after user gesture (gift click)
      bgm.volume = MUSIC_VOLUME;
      bgm.play().catch(() => {
        // If blocked, user can toggle icon to try again
      });
    }

    function stopMusic(){
      bgm.pause();
    }

    function showMusicToggle(){
      musicToggle.classList.add("show");
      musicToggle.setAttribute("aria-pressed", musicOn ? "true" : "false");
      musicIcon.textContent = musicOn ? "üéµ" : "üîá";
    }

    function openGift(){
      if (giftOpened) return;
      giftOpened = true;

      // Gift opening animation
      gift.classList.add("opening");

      // Fade out intro after a short moment
      window.setTimeout(() => {
        intro.classList.add("fade-out");
      }, 520);

      // Start music only after gift click
      startMusic();
      showMusicToggle();

      // Reveal main content
      window.setTimeout(() => {
        intro.style.display = "none";
        content.classList.add("show");
        runMessageSequence();
      }, 980);
    }

    gift.addEventListener("click", openGift);
    gift.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " "){
        e.preventDefault();
        openGift();
      }
    });

    /* =========================================================
       MESSAGE TIMING (line-by-line fade in)
    ========================================================== */
    function runMessageSequence(){
      msgLines.forEach(line => {
        const delay = Number(line.getAttribute("data-delay") || "0");
        window.setTimeout(() => line.classList.add("show"), delay);
      });

      // After message lines, show question and boxes
      window.setTimeout(() => {
        question.classList.add("show");
        staggerChoices();
      }, 4500);
    }

    function staggerChoices(){
      const items = $$(".choice", choices);
      items.forEach((el, i) => {
        window.setTimeout(() => el.classList.add("show"), 200 + i * 220);
      });
    }

    /* =========================================================
       BOX INTERACTION LOGIC
    ========================================================== */
    function setResult(htmlText, extraNodes=null){
      resultText.innerHTML = htmlText;
      // Remove old actions if any
      const oldActions = result.querySelector(".mini-actions");
      if (oldActions) oldActions.remove();
      if (extraNodes) result.appendChild(extraNodes);
    }

    function token(){
      currentActionToken += 1;
      return currentActionToken;
    }

    // Box 1
    box1.addEventListener("click", () => {
      const t = token();
      setResult("ƒêi ng·ªß üò¥");
      // After 5 seconds, show follow-up
      window.setTimeout(() => {
        if (t !== currentActionToken) return;
        setResult("ƒêi ng·ªß üò¥<br><span style='color:var(--hot); font-weight:900;'>Anh nh·ªõ p√≠ na qu√° √≤iii üíï</span>");
        heartBurstNearResult();
      }, 5000);
    });

    // Box 2
    box2.addEventListener("click", () => {
      const t = token();
      setResult("ƒêi coi phim üé¨<br><span class='muted'>ƒê·ª£i x√≠u‚Ä¶ anh l·ª±a n√®‚Ä¶</span>");
      window.setTimeout(() => {
        if (t !== currentActionToken) return;

        const actions = document.createElement("div");
        actions.className = "mini-actions";

        const bA = document.createElement("button");
        bA.className = "btn alt";
        bA.type = "button";
        bA.textContent = "Thi√™n ƒë∆∞·ªùng m√°u";

        const bB = document.createElement("button");
        bB.className = "btn";
        bB.type = "button";
        bB.textContent = "Gi·ªëng box 1 hehe";

        actions.appendChild(bA);
        actions.appendChild(bB);

        setResult("Ch·ªçn ƒëi n√® Pinaaa üíñ", actions);

        bB.addEventListener("click", () => {
          if (t !== currentActionToken) return;
          // Playful shake + heart pop
          result.classList.remove("shake");
          void result.offsetWidth;
          result.classList.add("shake");
          setResult("<span style='color:var(--hot); font-weight:900;'>Pina d√¢m qu√° aaa üò≥üò≥</span>");
          popHearts(8);
        });

        bA.addEventListener("click", () => {
          if (t !== currentActionToken) return;
          setResult("ƒê·ªÉ tu·∫ßn t·ªõi n·ªØa m√¨nh ƒëi hehe üé¨üíï");
          softSparkle();
        });

      }, 5000);
    });

    // Box 3 (mystery typing effect)
    box3.addEventListener("click", () => {
      const t = token();
      const full = "anh mu·ªën hun p√≠ na ch·ª•t ch·ª•t ch·ª•ttttttt\nth√≠u h∆°i qu√° √≤iii üòòüíñ";

      // Start with typing container
      setResult("<span class='typing' id='typingText'></span><span class='caret'>|</span>");
      const typingEl = $("#typingText");

      let i = 0;
      const speed = 38; // intimate, not too fast
      const timer = window.setInterval(() => {
        if (t !== currentActionToken){
          window.clearInterval(timer);
          return;
        }
        typingEl.textContent = full.slice(0, i);
        i++;
        if (i > full.length){
          window.clearInterval(timer);
          // final little heart pop
          heartBurstNearResult();
        }
      }, speed);
    });

    /* =========================================================
       SOFT EFFECT HELPERS (not overwhelming)
    ========================================================== */
    function heartBurstNearResult(){
      const rect = result.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      popAt(cx, cy);
      popAt(cx - 36, cy + 10);
      popAt(cx + 34, cy - 6);
    }

    function popHearts(n=6){
      const rect = result.getBoundingClientRect();
      for (let k=0; k<n; k++){
        const x = rect.left + rect.width/2 + (Math.random()*90 - 45);
        const y = rect.top + rect.height/2 + (Math.random()*40 - 20);
        window.setTimeout(() => popAt(x, y), k*55);
      }
    }

    function softSparkle(){
      const rect = result.getBoundingClientRect();
      const points = [
        [rect.left + rect.width*0.35, rect.top + rect.height*0.45],
        [rect.left + rect.width*0.55, rect.top + rect.height*0.35],
        [rect.left + rect.width*0.62, rect.top + rect.height*0.58],
      ];
      points.forEach((p, idx) => window.setTimeout(() => {
        const el = document.createElement("div");
        el.className = "pop";
        el.textContent = "‚ú®";
        el.style.left = p[0] + "px";
        el.style.top = p[1] + "px";
        document.body.appendChild(el);
        window.setTimeout(() => el.remove(), 900);
      }, idx*110));
    }

    /* =========================================================
       MUSIC TOGGLE (optional)
    ========================================================== */
    musicToggle.addEventListener("click", async () => {
      musicOn = !musicOn;
      musicToggle.setAttribute("aria-pressed", musicOn ? "true" : "false");
      musicIcon.textContent = musicOn ? "üéµ" : "üîá";

      if (musicOn){
        // If gift already opened, try to play again
        if (giftOpened){
          try{
            bgm.volume = MUSIC_VOLUME;
            await bgm.play();
          }catch(e){}
        }
      }else{
        stopMusic();
      }
    });
  </script>
</body>
</html>

